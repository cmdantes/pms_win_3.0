<!DOCTYPE html>
<html lang="en">
   <head>
      {% load static %}
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
         integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
      <link rel="shortcut icon" type="image/png" href="{% static 'vendor/assets/img/favicon.ico' %}" />
      <link href="https://fonts.googleapis.com/css?family=Roboto+Slab&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="{% static 'vendor/assets/css/style.css' %}" />
      <link rel="stylesheet" href="{% static 'vendor/assets/css/style_loader.css' %}" />
      <title>MANUAL TICKETING REPORT</title>
   </head>
   <body>
      <div id="preloader">
         <img class="p" src="{% static 'vendor/assets/img/car2.gif' %}"></img>
      </div>
      <div class="container-fluid">
         <a href="#" id="test" onClick="javascript:fnExcelReport();" class="btn btn-success"><i
            class="far fa-file-excel"></i> Export To Excel</a>
         <table id="myTable" class="detail">
            {% for coms in com %}
            <tr>
               <td style="text-transform:uppercase">{{ coms.registered_name }}</td>
            </tr>
            <tr>
               <td style="text-transform:uppercase">{{coms.business_name }}</td>
            </tr>
            <tr>
               <td style="text-transform:uppercase">{{coms.business_address }}</td>
            </tr>
            <tr>
               <td style="text-transform:uppercase">VAT REG TIN: {{coms.vat_reg_tin}}</td>
            </tr>
            {% endfor %}
         </table>
         <hr>
         <table id="myTable2">
            <tr>
               <td style="text-align:center; font-weight: bold; font-size: 18px;">MANUAL TICKETING REPORT</td>
            </tr>
         </table>
         <table id="mytable3" class="detail">
            <tr>
            <tr>
               <td>Date From: {{ start_date }} </td>
            </tr>
            <tr>
               <td>Date To: {{ end_date }}</td>
            </tr>
            <tr>
               <td>Generated by: {{user}}</td>
            </tr>
            <tr>
               <td>Total Transactions: {{ tocash.txncount }}</td>
            </tr>
            <tr>
               <td>Gross Sales: {{tocash.gross|floatformat:2}}</td>
            </tr>
            <tr>
               <td>VATABLE Sales: {{ tocash.vatsales|floatformat:2  }}</td>
            </tr>
            <tr>
               <td>VAT Amount: {{ tocash.vatamount|floatformat:2 }}</td>
            </tr>
            <tr>
               <td>VAT Exempt Sales: {{ tocash.vatexemptsales|floatformat:2 }}</td>
            </tr>
         </table>
         <table id="mytable4" class="data table table-bordered table-hover">
            <thead class="thead-dark fixed">
               <th>DATE ENTRY</th>
               <th>TICKET NO.</th>
               <th>OPERATOR</th>
               <th>BUSINESS DATE</th>
               <th>VEHICLE</th>
               <th>PLATE #</th>
               <th>TIME-IN</th>
               <th>TIME-OUT</th>
               <th>GROSS SALES</th>
               <th>VATABLE SALE</th>
               <th>VAT AMOUNT</th>
               <th>VAT EXEMPT SALE</th>
            <tbody>
               {% for cas in cash %}
               <tr>
                  <td style="text-align:center">{{ cas.date_entry|date:'Y-m-d H:i:s' }}</td>
                  <td>{{ cas.ticket_no }}</td>
                  <td style="text-align:center">{{ cas.operator }}</td>
                  <td style="text-align:center">{{ cas.business_date}}</td>
                  <td style="text-align:center">{{ cas.vehicle_type }}</td>
                  <td style="text-align:center">{{ cas.plate_number }}</td>
                  <td style="text-align:center">{{ cas.time_in|date:'Y-m-d H:i:s' }}</td>
                  <td style="text-align:center">{{ cas.time_out|date:'Y-m-d H:i:s'  }}</td>
                  <td>{{ cas.gross_amount|floatformat:2 }}</td>
                  <td>{{ cas.vatable_sale|floatformat:2 }}</td>
                  <td>{{ cas.vat|floatformat:2 }}</td>
                  <td>{{ cas.vat_exempt_sale|floatformat:2 }}</td>
                  {% endfor %}
               </tr>
            </tbody>
            <tfoot>
               <th colspan="8">TOTAL</th>
               <th>{{ tocash.gross|floatformat:2 }}</th>
               <th>{{ tocash.vatsales|floatformat:2 }}</th>
               <th>{{ tocash.vatamount|floatformat:2 }}</th>
               <th>{{ tocash.vatexemptsales|floatformat:2 }}</th>
            </tfoot>
         </table>
      </div>
      <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/jquery-bez@1.0.11/src/jquery.bez.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min.js"></script>
      <script src="{% static 'vendor/assets/js/pace.js' %}"></script>
      <script>
         paceOptions = {
           ajax: true,
           document: true,
           eventLag: false
         };
         Pace.on('done', function () {
           $('.p').delay(500).animate({ top: '30%', opacity: '0' }, 3000, $.bez([0.19, 1, 0.22, 1]));
           $('#preloader').delay(1500).animate({ top: '-100%' }, 2000, $.bez([0.19, 1, 0.22, 1]));
           TweenMax.from(".title", 2, {
             delay: 1.8,
             y: 10,
             opacity: 0,
             ease: Expo.easeInOut
           })
         });
      </script>
      <script>
         function fnExcelReport() {
             var tab_text = '<html xmlns:x="urn:schemas-microsoft-com:office:excel">';
             tab_text = tab_text + '<head><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>';

             tab_text = tab_text + '<x:Name>Manual Ticketing Report</x:Name>';

             tab_text = tab_text + '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';
             tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>';

             tab_text = tab_text + "<table border='0.5px'>";
             tab_text = tab_text + $('#myTable').html() + $('#myTable2').html() + $('#mytable3').html() + $('#mytable4').html();
             tab_text = tab_text + '</table></body></html>';

             var data_type = 'data:application/vnd.ms-excel';

             var ua = window.navigator.userAgent;
             var msie = ua.indexOf("MSIE ");

             var fileName = 'manual_ticketing_report.xls';
             var blob = new Blob([tab_text], {
             type: "application/csv;charset=utf-8;"
             });

             if (window.navigator.msSaveBlob) {
             // FOR IE BROWSER
             navigator.msSaveBlob(blob, fileName);
             } else {
             // FOR OTHER BROWSERS
             var csvUrl = URL.createObjectURL(blob);
             $('#test').attr({
                 'download': fileName,
                 'href': csvUrl
             });
             }

         }

      </script>
   </body>
   <html>