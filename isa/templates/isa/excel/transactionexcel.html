<!DOCTYPE html>
<html lang="en">
   <head>
      {% load static %}
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
         integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
      <link rel="shortcut icon" type="image/png" href="{% static 'vendor/assets/img/favicon.ico' %}" />
      <link href="https://fonts.googleapis.com/css?family=Roboto+Slab&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="{% static 'vendor/assets/css/style.css' %}" />
      <title>Transaction Flow Report</title>
   </head>
   <body>
      <div class="container-fluid">
         <a href="#" id="test" onClick="javascript:fnExcelReport();" class="btn btn-success"><i
            class="far fa-file-excel"></i> Export To Excel</a>
         <table id="myTable" class="detail">
            {% for coms in com %}
            <tr>
               <td style="text-transform:uppercase">{{ coms.company}}</td>
            </tr>
            <tr>
               <td style="text-transform:uppercase">{{ coms.address }}</td>
            </tr>
            <tr>
               <td style="text-transform:uppercase">VAT REG TIN {{coms.tin}}</td>
            </tr>
            {% endfor %}
         </table>
         <hr>
         <table id="myTable2">
            <tr>
               <td style="text-align:center; font-weight: bold; font-size: 18px;">Transaction Flow Report</td>
            </tr>
         </table>
         <table id="mytable3" class="detail">
            <tr>
               <td>Date From: {{ trans.timein|date:'M-d-Y H:i:s' }} </td>
            </tr>
            <tr>
               <td>Date To: {{ trans.timeout|date:'M-d-Y H:i:s' }}</td>
            </tr>
            <tr>
               <td>Generated by: {{user}}</td>
            </tr>
            <tr>
               <td>Terminal/Cashier: {{ pos }}</td>
            </tr>
            <tr>
               <td>Total Transactions: {{ trans.txncount }}</td>
            </tr>
            <tr>
               <td>Gross Sales: {{trans.gross|floatformat:2}}</td>
            </tr>
            <tr>
               <td>VATABLE Sales: {{ trans.vatsales }}</td>
            </tr>
            <tr>
               <td>VAT Amount: {{ trans.vatamount|floatformat:2 }}</td>
            </tr>
            <tr>
               <td>VAT Exempt Sales: {{ trans.vatexemptsales|floatformat:2  }} </td>
            </tr>
            <tr>
               <td>Total Deductions: {{trans.discount}}</td>
            </tr>
            <tr>
               <td>Net Sales: {{ trans.netsales|floatformat:2  }}</td>
            </tr>
         </table>
         <table id="mytable4" class="data table table-bordered table-hover tableFixHead">
            <thead class="thead-dark fixed">
               <th>BUSINESS DATE</th>
               <th style="width: 100px;">OR# START</th>
               <th style="width: 100px;">OR# END</th>
               <th>TXN ACCOUNT</th>
               <th>GROSS SALES</th>
               <th>VATABLE SALES</th>
               <th>VAT AMOUNT</th>
               <th>VAT EXEMPT SALES</th>
               <th>TOTAL DEDUCTIONS</th>
               <th>NET SALES</th>
            </thead>
            <tbody>
               {% for cas in tocash %}
               <tr>
                  <td>{{ cas.business_date|date:"SHORT_DATE_FORMAT" }}</td>
                  <td>{{ cas.orstart }}</td>
                  <td>{{ cas.orend }}</td>
                  <td>{{ cas.txncount }}</td>
                  <td>{{ cas.gross|floatformat:2 }}</td>
                  <td>{{ cas.vatsales|floatformat:2 }}</td>
                  <td>{{ cas.vatamount|floatformat:2 }}</td>
                  <td>{{ cas.vatexemptsales|floatformat:2 }}</td>
                  <td>{{ cas.discount|floatformat:2 }}</td>
                  <td>{{ cas.netsales|floatformat:2 }}</td>
               </tr>
               {% endfor %}
               <tr>
                  <th colspan="3" style="text-align: center;">TOTAL</th>
                  <th style="font-weight: bold">{{ trans.txncount }}</th>
                  <th style="font-weight: bold">{{ trans.gross|floatformat:2 }}</th>
                  <th style="font-weight: bold">{{ trans.vatsales|floatformat:2 }}</th>
                  <th style="font-weight: bold">{{ trans.vatamount|floatformat:2 }}</th>
                  <th style="font-weight: bold">{{ trans.vatexemptsales|floatformat:2 }}</th>
                  <th style="font-weight: bold">{{ trans.discount|floatformat:2 }}</th>
                  <th style="font-weight: bold">{{ trans.netsales|floatformat:2 }}</th>
               </tr>
            </tbody>
         </table>
      </div>
      <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
      <script>
         function fnExcelReport() {
             var tab_text = '<html xmlns:x="urn:schemas-microsoft-com:office:excel">';
             tab_text = tab_text + '<head><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>';

             tab_text = tab_text + '<x:Name>Transaction Flow Report</x:Name>';

             tab_text = tab_text + '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';
             tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>';

             tab_text = tab_text + "<table border='0.5px'>";
             tab_text = tab_text + $('#myTable').html() + $('#myTable2').html() + $('#mytable3').html() + $('#mytable4').html();
             tab_text = tab_text + '</table></body></html>';

             var data_type = 'data:application/vnd.ms-excel';

             var ua = window.navigator.userAgent;
             var msie = ua.indexOf("MSIE ");

             if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
                 if (window.navigator.msSaveBlob) {
                     var blob = new Blob([tab_text], {
                         type: "application/csv;charset=utf-8;"
                     });
                     navigator.msSaveBlob(blob, 'transactionflowreport.xls');
                 }
             } else {
                 $('#test').attr('href', data_type + ', ' + encodeURIComponent(tab_text));
                 $('#test').attr('download', 'transactionflowreport.xls');
             }

         }

      </script>
   </body>
   <html>